@page "/Users"

@inherits ServicePageBase<USERS, IUserService>

<AuthenticationView>
    <Authenticated>
        <GenGrid DataSource="@DataSource" TModel="USERS"
                 EditMode="EditMode.SmartForm"
                 MaxWidth="MaxWidth.ExtraLarge"
                 Create="CreateAsync"
                 Update="UpdateAsync"
                 Delete="DeleteAsync"
                 Cancel="Cancel"
                 Load="LoadAsync"
                 Search="FindByParametersAsync"
                 Title="Users"
                 TemplateColor="@Color.Dark"
                 FixedFooter="true"
                 Height="500">

            <GenSearchFields>

                <GenCheckBox BindingField="@nameof(USERS.U_IS_ACTIVE)" Label="Is Active"
                             TrueText="Yes"
                             FalseText="No"
                             InitialValue="true"
                             xs="12" sm="12" md="12" lg="3" xl="3" xxl="3"/>

            </GenSearchFields>

            <GenColumns>
                <GenTextField BindingField="@nameof(USERS.U_NAME)" Label="Name"  />
                <GenTextField BindingField="@nameof(USERS.U_LASTNAME)" Label="Surname" />
                <GenTextField BindingField="@nameof(USERS.U_EMAIL)" Label="Email" />
                <GenTextField BindingField="@nameof(USERS.U_PHONE_NUMBER)" Label="Phone" OnValueChanged="Callback"  />
                <GenTextField BindingField="@nameof(USERS.U_PASSWORD)"
                              InputType="InputType.Password"
                              Label="Password" />
                
                <GenCheckBox BindingField="@nameof(USERS.U_IS_ACTIVE)" Label="Is Active"
                             TrueText="Yes"
                             FalseText="No" />
            </GenColumns>
            <GenSideButtons>
                <LogButton OnClick="x=> ShowLogs(context)"/>
            </GenSideButtons>
            <GenDetailGrid>
                <MudTabs Class="mt-5" Style="width:100%!important" Color="Color.Primary">
                    <MudTabPanel Text="Roles">
                        <UserRolesPage ParentModel="context" AUTH_TYPE="@nameof(ROLES)" />
                    </MudTabPanel>
                    <MudTabPanel Text="Permissions">
                        <UserRolesPage ParentModel="context" AUTH_TYPE="@nameof(PERMISSIONS)" />
                    </MudTabPanel>
                </MudTabs>
            </GenDetailGrid>
        </GenGrid>


    </Authenticated>
</AuthenticationView>


@code{
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await ReadAsync(default);
    }


    private void Callback(ValueChangedArgs<object> obj)
    {
       if(obj.Model is not USERS usr) return;

       usr.U_LASTNAME = new Random().Next(10).ToString();
    }

}